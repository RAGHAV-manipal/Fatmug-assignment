<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Details</title>
</head>
<body>
    <h1>{{ video.title }}</h1>
{% comment %} 
    <h2>Search Subtitles</h2>
    <form method="get" action="{% url 'search_subtitles' %}">
        <input type="hidden" name="video_id" value="{{ video.id }}">
        <input type="text" name="q" placeholder="Search subtitles" required>
        <button type="submit">Search</button>
    </form> {% endcomment %}
<br>
        <video id="video-player" width="640" height="360" controls>
            <source src="{{ video.file.url }}" type="video/mp4">
            Your browser does not support the video tag.
        </video>


    <div>
        <h3>Description:</h3>
        <p>{{ video.description }}</p>
    </div>

    <div>
        <h4>Uploaded on:</h4>
        <p>{{ video.uploaded_at }}</p>
    </div>

    <div>
        <h4>Subtitles (if available):</h4>
        {% if video.subtitle_file %}
            <a href="{{ video.subtitle_file.url }}">Download Subtitles</a>
        {% else %}
            <p>No subtitles available</p>
        {% endif %}
    </div>

    <div>
        <h4>Embedded Video (if available):</h4>
        {% if video.embedded_file %}
            <a href="{{ video.embedded_file.url }}">Download video  (including multiple language subtitles)</a>
            <!-- <video id="video-player" width="640" height="360" controls>
                <source src="{{ video.file.url }}" type="video/mp4">
                {% for subtitle in video.subtitle_files %}
                    <track kind="subtitles" srclang="en" src="{{ video.subtitle_file.url }}" label="english">
                {% endfor %}
                Your browser does not support the video tag.
            </video> -->
            
        {% else %}
            <p>No embedded video available</p>
        {% endif %}
    </div>

    <div>
        <form method="get" action="{% url 'search_subtitles' %}">
            <input type="hidden" name="video_id" value="{{ video.id }}">
            <input type="text" name="q" placeholder="Search subtitles" required>
            <button type="submit">Search</button>
        </form>
    
        <ul>
            {% for subtitle in subtitles %}
                <li>{{ subtitle.text }}</li>
            {% empty %}
                <li>No subtitles available.</li>
            {% endfor %}
        </ul>
    </div>


    <a href="{% url 'video_list' %}">Back to video list</a>

    <script>
        // Get the URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const timestamp = urlParams.get('timestamp'); // Get the timestamp from the URL
        const videoPlayer = document.getElementById('video-player');

        if (timestamp) {
            // Convert the timestamp to seconds
            const timeParts = timestamp.split(':'); // Assuming format is mm:ss
            const minutes = parseInt(timeParts[0], 10);
            const seconds = parseInt(timeParts[1], 10);
            const totalSeconds = (minutes * 60) + seconds; // Total seconds

            // Set the video player's current time to the timestamp
            videoPlayer.currentTime = totalSeconds;
            videoPlayer.play(); // Start playing the video
        }
    </script>
</body>
</html>